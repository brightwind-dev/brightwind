{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "definitions": {
    "statistic_type_id": {
      "type": ["string", "null"],
      "enum": [
        "avg",
        "sd",
        "max",
        "min",
        "count",
        "availability",
        "quality",
        "sum",
        "median",
        "mode",
        "range",
        "gust",
        "ti",
        "ti30sec",
        "text",
        null
      ]
    },
    "condition": {
      "type": "object",
      "properties": {
        "measurement_point_uuid": {
          "type": "string",
          "format": "regex",
          "pattern": "^[a-f0-9]{8}-?[a-f0-9]{4}-?4[a-f0-9]{3}-?[89ab][a-f0-9]{3}-?[a-f0-9]{12}$"
        },
        "statistic_type_id": { "$ref": "#/definitions/statistic_type_id" },
        "comparison_operator_id": {
          "type": "integer",
          "minimum": 1,
          "maximum": 6
        },
        "comparator_value": { "type": "number" },
        "and": {
          "type": "array",
          "items": { "$ref": "#/definitions/condition" },
          "minItems": 2
        },
        "or": {
          "type": "array",
          "items": { "$ref": "#/definitions/condition" },
          "minItems": 2
        },
        "not": { "$ref": "#/definitions/condition" }
      },
      "oneOf": [
        {
          "required": [
            "measurement_point_uuid",
            "comparison_operator_id",
            "comparator_value"
          ]
        },
        { "required": ["and"], "maxProperties": 1 },
        { "required": ["or"], "maxProperties": 1 },
        { "required": ["not"], "maxProperties": 1 }
      ]
    }
  },
  "type": "object",
  "properties": {
    "uuid": {
      "type": "string",
      "format": "regex",
      "pattern": "^[a-f0-9]{8}-?[a-f0-9]{4}-?4[a-f0-9]{3}-?[89ab][a-f0-9]{3}-?[a-f0-9]{12}$"
    },
    "measurement_location_uuid": {
      "type": "string",
      "format": "regex",
      "pattern": "^[a-f0-9]{8}-?[a-f0-9]{4}-?4[a-f0-9]{3}-?[89ab][a-f0-9]{3}-?[a-f0-9]{12}$"
    },
    "rule": {
      "type": "object",
      "properties": {
        "conditions": { "$ref": "#/definitions/condition" },
        "clean_out": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "measurement_point_uuid": {
                "type": "string",
                "format": "regex",
                "pattern": "^[a-f0-9]{8}-?[a-f0-9]{4}-?4[a-f0-9]{3}-?[89ab][a-f0-9]{3}-?[a-f0-9]{12}$"
              },
              "statistic_type_id": {
                "$ref": "#/definitions/statistic_type_id"
              },
              "date_from": {
                "type": ["string", "null"],
                "format": "regex",
                "pattern": "[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])T(2[0-3]|[01][0-9]):[0-5][0-9]"
              },
              "date_to": {
                "type": ["string", "null"],
                "format": "regex",
                "pattern": "[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])T(2[0-3]|[01][0-9]):[0-5][0-9]"
              }
            },
            "required": ["measurement_point_uuid"]
          },
          "minItems": 1
        }
      },
      "required": ["conditions", "clean_out"],
      "additionalProperties": false
    },
    "notes": { "type": ["string", "null"] },
    "update_at": { "type": ["string", "null"] },
    "updated_by": { "type": ["string", "null"] }
  },
  "required": ["rule"],
  "additionalProperties": false
}
